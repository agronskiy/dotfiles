#!/usr/bin/env bash

# Get the path to the current virtual environment
# Similar to vact, but outputs the path instead of activating

# Try to find python executable
python_cmd=""
if command -v python >/dev/null 2>&1; then
    python_cmd=$(which python)
elif command -v python3 >/dev/null 2>&1; then
    python_cmd=$(which python3)
else
    echo "Error: No python executable found" >&2
    exit 1
fi

# Check if we're in a virtual environment
# Virtual env python paths typically look like: /path/to/venv/bin/python
if [[ "$python_cmd" =~ /bin/python[0-9]*$ ]]; then
    # Strip /bin/python or /bin/python3 to get venv root
    venv_path="${python_cmd%/bin/python*}"

    # Verify it's actually a venv by checking for activate script, and copy to osc
    if [[ -f "$venv_path/bin/activate" ]]; then
        echo "$venv_path" | osc
        exit 0
    fi
fi

# If we get here, we're not in a virtual environment
echo "Error: Not in a virtual environment" >&2
exit 1
